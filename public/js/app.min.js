var GameApp;GameApp=function(){function t(e){this._=t,this.root=$(e).first(),this.addControls(),this.map=new HexaMap(this),this.getv_popup=new ArrowsPopup(this),this.sure_popup=new QueryPopup(this),this.c&&($(this.c).on("click",function(t){return function(e){return t.onClick(e)}}(this)),$(this.c).on("mousedown touchstart",function(t){return function(t){return!0}}(this)),$(this.c).on("dblclick",function(t){return function(e){return t.onDblClick(e)}}(this)),$(this.c).on("mousemove touchstart",function(t){return function(e){return t.onMove(e)}}(this))),this.render()}return t.prototype.CELL_SIDE=30,t.prototype.CELL_OFFSET=2,t.prototype.map=void 0,t.prototype.c=void 0,t.prototype.g=void 0,t.prototype.hover_cell=void 0,t.prototype.active_cell=void 0,t.prototype.state=1,t.prototype.controlls=void 0,t.prototype.resetMapBtn=void 0,t.prototype.randomMapBtn=void 0,t.prototype.MENU=0,t.prototype.GAME=1,t.prototype.GET_V=2,t.prototype.addControls=function(){var t,e;return console.log("addControls"),t=$("<canvas/>"),t.attr("width",600),t.attr("height",400),this.c=t[0],this.g=this.c.getContext("2d"),this.root.append(t),this.controlls=$("<div></div>"),this.controlls.addClass("controlls"),this.resetMapBtn=$("<a href='javascript:void(0);'>Reset</a>"),this.resetMapBtn.addClass("button reset"),this.controlls.append(this.resetMapBtn),e=[$("<a href='javascript:void(0);'>No</a>").addClass("button reject"),$("<a href='javascript:void(0);'>Yes</a>").addClass("button accept")],this.resetMapBtn.on("click",function(t){return function(o){return t.map.isDirty()?t.sure_popup.show(e,function(e,o){return e?t.map.resetMap():void 0}):void 0}}(this)),this.randomMapBtn=$("<a href='javascript:void(0);'>Random</a>"),this.randomMapBtn.addClass("button random"),this.controlls.append(this.randomMapBtn),this.randomMapBtn.on("click",function(t){return function(o){return t.map.isDirty()?t.sure_popup.show(e,function(e,o){return e?t.map.randomizeMap():void 0}):t.map.randomizeMap()}}(this)),this.root.prepend(this.controlls)},t.prototype.onDblClick=function(t){return!1},t.prototype.onClick=function(t){var e,o,i;switch(this.state){case this.GAME:e=HexaCell.getCellAt(this,t.offsetX,t.offsetY),e!==this.active_cell&&(null!=(i=this.active_cell)&&i.setActive(!1),null!=e&&e.setActive(!0),this.active_cell=e),(null!=e?e.isFilled():void 0)&&(o=HexaMap.splitFreeCells(this,e),o.length>1?(this.getv_popup.cell=e,this.getv_popup.free=o,this.state=this.GET_V,this.getv_popup.show(this.getv_popup.items(),function(t){return function(i,n){return e.connectTo(o[i]),t.state=t.GAME}}(this))):1===o.length&&e.connectTo(o)),this.render();break;case this.GET_V:return}return!0},t.prototype.onMove=function(t){var e,o;switch(this.state){case this.GAME:e=HexaCell.getCellAt(this,t.offsetX,t.offsetY),e!==this.hover_cell&&(null!=(o=this.hover_cell)&&o.setHover(!1),null!=e&&e.setHover(!0),this.hover_cell=e,this.render());break;case this.GET_V:return}return!0},t.prototype.render=function(){switch(this.state){case this.GAME:return this.g.fillStyle="#eee",this.g.clearRect(0,0,this.c.width,this.c.height),this.map.render();case this.GET_V:}},t.prototype.isState=function(t){return this.state===t},t}(),$(function(){var t;return t=new GameApp($(".content .game")),window.app=t}),window.GameApp=GameApp;