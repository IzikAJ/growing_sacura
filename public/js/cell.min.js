var HexaCell;HexaCell=function(){function t(e,i,o){this.app=e,this.x=i,this.y=o,this._=t,this.CELL_SIDE=this.app.CELL_SIDE,this.CELL_OFFSET=this.app.CELL_OFFSET,this.connectors=new Array,this.id=this._.__count++}return t.prototype.CELL_SIDE=void 0,t.prototype.CELL_OFFSET=void 0,t.prototype.color="#000",t.prototype.state=0,t.prototype.data=void 0,t.prototype.connectors=void 0,t.HOVER=1,t.ACTIVE=2,t.FILLED=4,t.__count=0,t.prototype.id=void 0,t.prototype.render=function(t){var e,i,o,n,s,r;return null==t&&(t=[0,0]),e=this.CELL_SIDE,i=this.CELL_SIDE*Math.sin(Math.PI/3),o=this.app.g,t=this.app.map.offset,n=this.cellPosition(),s=n.x+t.x||0,r=n.y+t.y||0,o.fillStyle="#999",this.isActive()?o.strokeStyle="#0F0":this.isHover()?o.strokeStyle="#F00":o.strokeStyle="#000",o.lineWidth=2,o.beginPath(),o.moveTo(s-e,r),o.lineTo(s-.5*e,r-i),o.lineTo(s+.5*e,r-i),o.lineTo(s+e,r),o.lineTo(s+.5*e,r+i),o.lineTo(s-.5*e,r+i),o.closePath(),this.isFilled()&&o.fill(),o.stroke(),o.lineWidth=1,o.strokeStyle="#000"},t.prototype.position=function(t,e){var i,o,n,s;return null==t&&(t=void 0),null==e&&(e=void 0),i=this.CELL_SIDE,o=this.CELL_SIDE*Math.sin(Math.PI/3),n=1.5*(i+this.CELL_OFFSET)*((t||this.x)+(e||this.y)),s=(o+this.CELL_OFFSET)*((e||this.y)-(t||this.x)),{x:n,y:s}},t.prototype.cellPosition=function(){var t,e,i,o;return t=this.CELL_SIDE,e=this.CELL_SIDE*Math.sin(Math.PI/3),i=1.5*(t+this.CELL_OFFSET)*(this.x+this.y),o=(e+this.CELL_OFFSET)*(this.y-this.x),{x:i,y:o}},t.getCellAt=function(t,e,i){var o;return o=this.getCellPositionAt(t,e,i),t.map.getCell(o.x,o.y)},t.prototype.closestCellsP=function(){return this.app.map.closestCells(null,this.x,this.y)},t.prototype.freeCells=function(){var t,e;return e=this.app.map.getCells(this.app.map.closestCells(null,this.x,this.y)),e=e.filter(function(t){return!(null!=t?t.isFilled():void 0)}),t=[],this.connectors.forEach(function(e){var i,o;return i=e.cell_a.closestCellsP(),o=e.cell_b.closestCellsP(),t=t.concat(i.filter(function(t){return o.filter(function(e){return t.x===e.x&&t.y===e.y}).length>0}))}),e=e.filter(function(e){return 0===t.filter(function(t){return e.x===t.x&&e.y===t.y}).length})},t.prototype.connectTo=function(e){return e?Array.isArray(e)?e.forEach(function(t){return function(e){return t.connectTo(e)}}(this)):t.prototype.isPrototypeOf(e)?(e&&this.app.map.connectors.push(new CellConnector(this.app,this,e)).length,this.app.map.setDirty(),e.setFilled()):this.connectTo(this.app.map.getCell(e.x,e.y)):void 0},t.getCellPositionAt=function(t,e,i){var o,n,s,r,l,h,p,a;return h=e-t.map.offset.x,a=i-t.map.offset.y,o=t.CELL_SIDE+t.CELL_OFFSET,n=t.CELL_SIDE*Math.sin(Math.PI/3)+t.CELL_OFFSET,s=h/(3*o)+.5,r=a/(2*n),l=s-r,p=s+r,0>l&&(l=-1),0>p&&(p=-1),{x:~~l,y:~~p}},t.prototype.getCellOn=function(t,e){return this.getCellAt(t,e.offsetX,e.offsetY)},t.prototype.setHover=function(e){return null==e&&(e=!0),this.state=(this.state|t.HOVER)^(e?0:t.HOVER)},t.prototype.isHover=function(){return!!(this.state&t.HOVER)},t.prototype.setActive=function(e){return null==e&&(e=!0),this.state=(this.state|t.ACTIVE)^(e?0:t.ACTIVE)},t.prototype.isActive=function(){return!!(this.state&t.ACTIVE)},t.prototype.setFilled=function(e){return null==e&&(e=!0),this.state=(this.state|t.FILLED)^(e?0:t.FILLED)},t.prototype.isFilled=function(){return!!(this.state&t.FILLED)},t}(),window.HexaCell=HexaCell;